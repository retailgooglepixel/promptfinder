<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Prompt-Discovery Tool</title>
    <!-- Lade Tailwind CSS CDN f√ºr einfachem Hosting (ideal f√ºr GitHub Pages) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfiguriere Tailwind f√ºr benutzerdefinierte Farben und Schriftart -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-blue': '#02042A', // Tiefer Blauton f√ºr den Hintergrund
                        'gemini-gold': '#FBBF24', // Goldener Akzent
                        'gemini-teal': '#00ADB5', // Akzentfarbe
                        'gemini-red': '#EF4444', // Fehlerfarbe
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* CSS f√ºr subtile Animationen und Responsivit√§t */
        .prompt-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        /* Responsives Hover-Feedback */
        .prompt-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(251, 191, 36, 0.3);
        }
        /* Akkordeon Animation */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-content.active {
            max-height: 500px; /* Muss gro√ü genug sein, um den Inhalt anzuzeigen */
            transition: max-height 0.5s ease-in-out;
        }
        /* Lade-Spinner Animation */
        .loading-spinner {
            border-top-color: #FBBF24;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Fix f√ºr Dropdown-Hintergrund auf manchen Browsern */
        #season-select {
            background-image: none; /* Entfernt native Dropdown-Pfeil-Hintergr√ºnde, wenn n√∂tig */
        }
    </style>
</head>
<body class="bg-deep-blue font-sans text-white min-h-screen p-4 sm:p-8">

    <!-- Header & Titel -->
    <header class="text-center mb-12">
        <h1 id="main-title" class="text-4xl sm:text-5xl font-extrabold text-gemini-gold mb-2">
            Gemini & Pixel: Deine KI-Inspiration
        </h1>
        <p class="text-lg text-gray-300 max-w-3xl mx-auto">
            Entdecke saisonale Prompts, die das Beste aus Gemini und deinem Google Pixel herausholen.
        </p>

        <!-- Saisonauswahl Dropdown -->
        <div class="mt-6">
            <label for="season-select" class="block text-gray-300 mb-2 font-medium">Anlass w√§hlen:</label>
            <select id="season-select" onchange="changeSeason(this.value)"
                    class="bg-deep-blue border border-gemini-teal text-white p-3 rounded-lg focus:ring-gemini-gold focus:border-gemini-gold transition duration-150 w-full sm:w-64 appearance-none">
                <option value="Weihnachten">Weihnachten</option>
                <option value="Silvester">Silvester & Neujahr</option>
                <option value="Urlaub">Sommer & Urlaub</option>
                <option value="Neues Jahr">Vors√§tze f√ºr das Neue Jahr</option>
            </select>
        </div>
    </header>

    <!-- Hauptbereich: Prompt Discovery und Ergebnis-Anzeige -->
    <!-- Max-Breite und Zentrierung f√ºr gro√üe Bildschirme hinzugef√ºgt -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">

        <!-- Linke Spalte: Prompt-Karten (lg:col-span-2) -->
        <div class="lg:col-span-2 space-y-6">
            <h2 id="prompt-section-title" class="text-2xl font-bold text-white mb-4 border-b-2 border-gemini-teal pb-2">Aktuelle Prompt-Ideen</h2>
            
            <!-- Prompt-Karten Container -->
            <div id="prompt-cards-container" class="space-y-4">
                <!-- Die Prompt-Karten werden hier dynamisch eingef√ºgt -->
            </div>
        </div>

        <!-- Rechte Spalte: Detailansicht und FAQ (lg:col-span-1) -->
        <div class="lg:col-span-1 space-y-8 mt-6 lg:mt-0">
            
            <!-- Detailansicht (Ergebnis-Anzeige) -->
            <div class="bg-white/10 p-6 rounded-xl shadow-2xl border border-gemini-teal/50">
                <h2 class="text-xl font-bold mb-4 text-gemini-gold border-b border-gemini-gold/50 pb-2">Prompt-Detailansicht</h2>
                
                <div id="detail-view" class="space-y-4 text-gray-200">
                    <p id="detail-placeholder" class="text-center italic text-gray-400">
                        W√§hle links eine Prompt-Idee aus, um alle Details zu sehen.
                    </p>
                    <h3 id="detail-title" class="text-2xl font-semibold hidden"></h3>
                    <div id="detail-content" class="space-y-4 hidden">
                        <div class="bg-white/10 p-3 rounded-lg">
                            <p class="text-sm text-gemini-gold font-medium">Prompt-Text:</p>
                            <!-- word-break hinzugef√ºgt, um lange Prompts auf Mobilger√§ten zu handhaben -->
                            <p id="detail-prompt" class="italic text-lg break-words"></p>
                        </div>
                        <div class="bg-white/10 p-3 rounded-lg">
                            <p class="text-sm text-gemini-gold font-medium">Empfohlenes Modell/Tool:</p>
                            <p id="detail-model" class="font-bold"></p>
                        </div>
                        <p id="detail-explanation"></p>

                        <!-- Gemini API Features -->
                        <div id="api-features-container" class="flex flex-col space-y-3 mt-4">
                            <!-- Buttons or Error message here -->
                            <button id="optimize-prompt-btn"
                                    class="w-full bg-gemini-teal hover:bg-gemini-teal/80 text-deep-blue font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 disabled:opacity-50"
                                    onclick="generateOptimizedPrompt()">
                                ‚ú® Prompt optimieren (Zum Super-Prompt)
                            </button>
                            <button id="ai-explanation-btn"
                                    class="w-full bg-gemini-gold hover:bg-gemini-gold/80 text-deep-blue font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 disabled:opacity-50"
                                    onclick="generateAiExplanation()">
                                ‚ú® KI-Erkl√§rung anfordern
                            </button>
                        </div>
                        
                        <!-- Output Area -->
                        <div id="output-area" class="mt-6 p-4 bg-deep-blue rounded-lg border border-gemini-gold/50 hidden">
                            <p id="output-title" class="font-bold text-gemini-gold mb-2"></p>
                            <div id="output-text" class="text-gray-300 whitespace-pre-wrap text-sm"></div>
                            <div id="output-loading" class="text-center hidden">
                                <div class="loading-spinner border-4 border-gray-700 h-6 w-6 rounded-full mx-auto"></div>
                                <p class="mt-2 text-sm text-gemini-teal">Gemini arbeitet...</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- FAQ-Sektion -->
            <div class="bg-white/10 p-6 rounded-xl shadow-2xl border border-gemini-teal/50">
                <h2 class="text-xl font-bold mb-4 text-gemini-gold border-b border-gemini-gold/50 pb-2">FAQs & Vertiefung</h2>
                
                <div class="space-y-3" id="faq-container">
                    <!-- FAQs werden hier dynamisch eingef√ºgt -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- Globale Datenstruktur f√ºr Prompts und FAQs ---
        const ALL_CONTENT = {
            "Weihnachten": {
                title: "Weihnachtliche Prompt-Ideen",
                prompts: [
                    { id: "geschenk", title: "üéÅ Der perfekte Geschenkefinder", model: "Gemini-Apps (Deep Research)",
                      prompt: "Finde 5 einzigartige, personalisierte Geschenkideen f√ºr meinen Vater, der Hobbykoch ist, gerne wandert und gerade ein Pixel 10 bekommen hat. Budget: max. 150 ‚Ç¨.",
                      explanation: "Gemini nutzt **Deep Research**, um aktuelle, bewertete Produkte und relevante Links zu finden. Ein Klick und die Liste ist fertig.",
                      faqs: ["faq-deep-research", "faq-apps", "faq-updates"] },
                    { id: "fotos", title: "‚ú® Magische Festtagsfotos", model: "KI-basierte Fotografie (Tensor G5)",
                      prompt: "Ich habe ein Foto mit Lichtern im Hintergrund gemacht. Reduziere das Pixelrauschen und verst√§rke den Bokeh-Effekt der Lichter, ohne die Gesichter unscharf zu machen.",
                      explanation: "Nutzt die **KI-basierte Rauschunterdr√ºckung** und die **Magische Bearbeitung**, um Tiefensch√§rfe nachtr√§glich zu optimieren. Keine komplizierte Software n√∂tig ‚Äì alles auf dem Pixel.",
                      faqs: ["faq-autobest", "faq-kamera-coach", "faq-updates"] },
                    { id: "rezept", title: "üçΩÔ∏è Men√ºplanung mit Einschr√§nkungen", model: "Gemini-Apps (App-√ºbergreifende Aktionen)",
                      prompt: "Ich plane ein Weihnachtsmen√º f√ºr 8 Personen, darunter 2 Vegetarier und 1 Person mit Nussallergie. Erstelle ein 3-G√§nge-Men√º und generiere sofort eine optimierte Einkaufsliste.",
                      explanation: "Gemini verarbeitet komplexe Einschr√§nkungen und generiert sofort eine **strukturierte Liste**, die direkt in Google Keep oder Google Sheets exportiert werden kann.",
                      faqs: ["faq-apps", "faq-deep-research", "faq-akku"] },
                    { id: "video", title: "üé• Weihnachts-Video-Gru√ü", model: "Google AI Pro (Veo 3 Fast)",
                      prompt: "Generiere ein **kurzes, festliches 8-Sekunden-Video** mit sanft fallendem Schnee und einem kurzen, warmen 'Frohe Weihnachten'-Text in Schreibschrift. Ich m√∂chte es √ºber WhatsApp verschicken.",
                      explanation: "Nutzt die **Video-Generierung** von Gemini (Veo Fast, mit Google AI Pro Abo) zur Erstellung von hochwertigen Social-Media-Assets direkt auf dem Ger√§t.",
                      faqs: ["faq-veo-video", "faq-apps", "faq-updates"] }
                ]
            },
            "Silvester": {
                title: "Silvester & Neujahrs-Prompt-Ideen",
                prompts: [
                    { id: "partyplan", title: "üéâ Partyplanung und Checkliste", model: "Gemini-Apps (Planung)",
                      prompt: "Erstelle eine detaillierte Checkliste f√ºr eine Silvesterparty mit 15 G√§sten. F√ºge Punkte f√ºr Deko, Snacks und Spiele hinzu.",
                      explanation: "Gemini hilft bei der **mehrstufigen Planung** und Organisation, die direkt in Ihren Kalender integriert werden kann.",
                      faqs: ["faq-apps", "faq-deep-research", "faq-akku"] },
                    { id: "firework", title: "üéÜ Perfekte Feuerwerk-Fotos", model: "KI-basierte Fotografie (Pro-Modi)",
                      prompt: "Optimiere die Kameraeinstellungen f√ºr ein Feuerwerk-Foto in der 'Pro-Funktionen'-App, um die Lichtspuren scharf zu erfassen.",
                      explanation: "Nutzt die **Pro-Funktionen** (manuelle Einstellungen) und Gemini, um die besten Ergebnisse bei schwierigen Lichtverh√§ltnissen zu erzielen, wie sie Thomas und Emilia suchen.",
                      faqs: ["faq-kamera-coach", "faq-updates", "faq-autobest"] },
                    { id: "gruss", title: "‚úçÔ∏è Individuelle Neujahrsgr√º√üe", model: "Gemini (Kreativit√§t)",
                      prompt: "Schreibe 5 kurze, humorvolle Neujahrsgr√º√üe f√ºr WhatsApp und 5 formelle Gr√º√üe f√ºr E-Mail-Kontakte.",
                      explanation: "Gemini hilft beim Verfassen von Inhalten und spart Zeit beim Versenden von personalisierten Gr√º√üen an unterschiedliche Zielgruppen.",
                      faqs: ["faq-updates", "faq-akku"] }
                ]
            },
            "Urlaub": {
                title: "Sommer & Urlaubs-Prompt-Ideen",
                prompts: [
                    { id: "route", title: "üó∫Ô∏è Interaktive Reiseroute", model: "Gemini-Apps (Maps Integration)",
                      prompt: "Erstelle eine 4-t√§gige Reiseroute durch Skandinavien mit Fokus auf Fjorde und F√§hren. F√ºge √ñffnungszeiten und Wettervorhersage hinzu.",
                      explanation: "Dank der Integration in Google Maps kann Gemini eine detaillierte, interaktive Reiseroute erstellen, die alle wichtigen Informationen enth√§lt.",
                      faqs: ["faq-apps", "faq-kamera-coach", "faq-akku"] },
                    { id: "language", title: "üó£Ô∏è Live-√úbersetzung beim Anruf", model: "Live-√úbersetzung (Gemini Nano)",
                      prompt: "√úbersetze live mein Gespr√§ch mit dem Hotelier in Schweden und gib seine Antwort in meiner Stimme wieder.",
                      explanation: "Die **Live-√úbersetzung** (Sprachfunktionen) auf dem Pixel erm√∂glicht authentische Telefongespr√§che in verschiedenen Sprachen, angetrieben durch den **Tensor G5**.",
                      faqs: ["faq-g5-chip", "faq-updates", "faq-live-cam"] },
                    { id: "pack", title: "üß≥ Packliste nach Wetterlage", model: "Gemini (Kontextsensitivit√§t)",
                      prompt: "Erstelle eine Packliste f√ºr eine Woche in Barcelona im August. Ich plane Strandtage, Sightseeing und zwei formelle Abendessen.",
                      explanation: "Gemini ber√ºcksichtigt den Kontext (Ort, Datum, Aktivit√§ten) und generiert eine ma√ügeschneiderte Liste, die direkt in Google Keep exportiert werden kann.",
                      faqs: ["faq-apps", "faq-akku", "faq-live-cam"] }
                ]
            },
            "Neues Jahr": {
                title: "Vors√§tze f√ºr das Neue Jahr",
                prompts: [
                    { id: "fitness", title: "üèãÔ∏è Personalisiertes Training", model: "Gemini-Apps (Fitbit Integration)",
                      prompt: "Erstelle einen 4-w√∂chigen Trainingsplan f√ºr mehr Ausdauer, basierend auf meinen letzten L√§ufen, die in Fitbit gespeichert sind. Halte die Einheiten unter 45 Minuten.",
                      explanation: "Gemini kann auf verbundene Apps wie **Fitbit Premium** zugreifen (6 Monate kostenlos mit Pixel), um personalisierte Pl√§ne basierend auf echten Daten zu erstellen.",
                      faqs: ["faq-apps", "faq-akku", "faq-updates"] },
                    { id: "finance", title: "üí∞ Finanzielle √úbersicht", model: "Gemini (Zusammenfassung)",
                      prompt: "Fasse meine E-Mails des letzten Monats mit dem Stichwort 'Abo-Rechnung' zusammen und erstelle eine Tabelle mit monatlichen Ausgaben.",
                      explanation: "Gemini kann E-Mails aus **Gmail zusammenfassen** und strukturierte Listen erstellen, um einen schnellen √úberblick √ºber die Finanzen zu erhalten (ideal f√ºr Nadja die Gesch√§ftsfrau).",
                      faqs: ["faq-apps", "faq-deep-research", "faq-updates"] }
                ]
            }
        };

        // --- Allgemeine und Kontext-FAQs ---
        const ALL_FAQS = {
            // Allgemeine FAQs
            "faq-autobest": { title: "Wie sorge ich daf√ºr, dass auf Gruppenfotos alle l√§cheln?", content: 'Nutzen Sie die KI-Funktion **"Automatische Beste Aufnahme"** im Google Fotos-Editor. Die KI w√§hlt automatisch das beste L√§cheln jeder Person aus einer Serie von Aufnahmen und kombiniert sie nahtlos zu einem perfekten Bild.' },
            "faq-updates": { title: "Wie lange ist mein Pixel 10 aktuell und sicher?", content: 'Die Pixel 10 Serie bietet **7 Jahre lang Betriebssystem- und Sicherheitsupdates**. Das Ger√§t bleibt dadurch lange auf dem neuesten Stand und die KI-Funktionen werden durch regelm√§√üige Pixel Drops automatisch aktualisiert und verbessert.' },
            "faq-live-cam": { title: "Was ist der Vorteil von Gemini Live mit Kamera?", content: 'Mit **Gemini Live mit Kamera** k√∂nnen Sie Ihre Kamera in einer Gemini-Unterhaltung teilen, um **Live-Feedback in Echtzeit** √ºber das zu erhalten, was Sie sehen. Gemini kann bewegte Inhalte (wie Videos) und den visuellen Kontext verstehen und darauf reagieren.' },
            "faq-akku": { title: "Wie lange h√§lt der Akku bei starker KI-Nutzung?", content: 'Die Pixel 10 Pro-Modelle sind f√ºr die **l√§ngste Akkulaufzeit** auf einem Pixel optimiert und halten √ºber 24 Stunden. Der **Google Tensor G5** ist speziell f√ºr KI konzipiert und sorgt f√ºr maximale Effizienz.' },
            "faq-g5-chip": { title: "Welchen Vorteil bringt der Tensor G5 f√ºr die KI?", content: 'Der neue **Google Tensor G5** verf√ºgt √ºber eine **60 % leistungsst√§rkere TPU** (Tensor Processing Unit), die speziell f√ºr die fortschrittlichen KI-Funktionen auf dem Ger√§t (z.B. Live-√úbersetzung) entwickelt wurde.' },

            // Kontextbezogene FAQs
            "faq-deep-research": { title: "Was bedeutet 'Deep Research'?", content: "Deep Research ist eine Funktion von Gemini (Google AI Pro Abo), die detaillierte Berichte zu komplexen Themen erstellt und Quellenangaben aus Web-Quellen zitiert. Ideal f√ºr gut recherchierte Geschenkideen oder Planung." },
            "faq-apps": { title: "Wie funktioniert die App-√ºbergreifende Integration?", content: "Gemini kann Aktionen in Google-Apps (Gmail, Kalender, Maps) und Drittanbieter-Apps (Spotify, WhatsApp) ausf√ºhren, ohne dass Sie die Ansicht wechseln m√ºssen. Fragen Sie Gemini einfach, und es erledigt die Aufgabe √ºber die Apps hinweg." },
            "faq-veo-video": { title: "Wie bekomme ich Zugriff auf die Video-Generierung?", content: 'Die **Video-Generierung** (Veo 3 Fast) ist Teil des **Google AI Pro Abos**. Beim Kauf eines Pixel 10 Pro oder Pro XL erhalten Sie dieses Abo f√ºr 1 Jahr ohne Zusatzkosten.' },
            "faq-kamera-coach": { title: "Wie unterst√ºtzt mich der Kamera-Coach?", content: 'Der **Kamera-Coach** nutzt Gemini-Modelle, um das Ambiente in Echtzeit zu erkennen und schl√§gt den besten Blickwinkel, die ideale Beleuchtung und den geeigneten Kameramodus vor, damit Sie das Kamerasystem optimal nutzen k√∂nnen.' }
        };

        let activeSeason = "Weihnachten";
        let activePromptId = null;

        // --- Gemini API Konfiguration ---
        // FIX: Zur√ºcksetzen auf die explizite Preview-URL (gemini-2.5-flash-preview-09-2025), da diese oft von der Laufzeitumgebung f√ºr die Schl√ºssel-Injektion ben√∂tigt wird, um 403-Fehler zu vermeiden.
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Canvas Runtime provides this

        // 1. Hilfsfunktion f√ºr die API-Kommunikation mit Backoff
        async function fetchWithBackoff(url, payload, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url + API_KEY, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    } else if (response.status === 429 && i < retries - 1) { // Rate limit
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                        continue;
                    } else {
                        // Bei Fehlern wie 403, 400 oder 500 sofort abbrechen und Fehler werfen
                        const errorText = await response.text();
                        throw new Error(`API call failed with status: ${response.status}. Response: ${errorText}`);
                    }
                } catch (error) {
                    if (i === retries - 1) {
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // --- Platzhalter-Funktion bei Berechtigungsproblemen ---
        function showApiErrorPlaceholder() {
            const container = document.getElementById('api-features-container');
            container.innerHTML = `
                <div class="bg-gemini-red/20 border border-gemini-red p-4 rounded-lg text-sm">
                    <p class="font-bold text-gemini-red mb-2">‚ö† KI-Funktionen sind aktuell DEAKTIVIERT</p>
                    <p class="text-gray-300">Es liegt ein Berechtigungsproblem (403 Forbidden) mit der Gemini API-Freigabe der Hosting-Umgebung vor. Die Interaktivit√§t kann nicht demonstriert werden. Die Prompts und Erkl√§rungen dienen weiterhin als Lesebeispiele.</p>
                </div>
            `;
            document.getElementById('output-area').classList.add('hidden');
        }

        // 2. Gemini Feature: Prompt Optimierer
        async function generateOptimizedPrompt() {
            if (!activePromptId) return;

            // F√ºhren Sie die KI-Funktion NICHT aus, wenn ein bekannter Fehler vorliegt
            if (document.getElementById('api-features-container').innerHTML.includes('DEAKTIVIERT')) return;
            
            const currentPrompts = ALL_CONTENT[activeSeason].prompts;
            const promptData = currentPrompts.find(p => p.id === activePromptId);
            const originalPrompt = promptData.prompt;
            const model = promptData.model;
            
            const outputArea = document.getElementById('output-area');
            const outputTitle = document.getElementById('output-title');
            const outputText = document.getElementById('output-text');
            const outputLoading = document.getElementById('output-loading');

            // UI-Update: Loading starten
            outputArea.classList.remove('hidden');
            outputTitle.textContent = "Optimierter Prompt (Super-Prompt):";
            outputText.textContent = "";
            outputLoading.classList.remove('hidden');

            // Buttons deaktivieren
            document.getElementById('optimize-prompt-btn').disabled = true;
            document.getElementById('ai-explanation-btn').disabled = true;

            const userQuery = `Nimm diesen kurzen Prompt: "${originalPrompt}" und wandle ihn in einen ausf√ºhrlichen, optimierten "Super-Prompt" um. Der neue Prompt sollte maximal 50 W√∂rter lang sein und alle relevanten Details und Anweisungen enthalten, die f√ºr das empfohlene Modell (${model}) n√∂tig sind, um das bestm√∂gliche Ergebnis zu erzielen. Gib nur den optimierten Prompt zur√ºck, ohne Einleitungssatz.`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: "Du bist ein KI-Prompt-Experte. Deine Aufgabe ist es, kurze Anfragen in hochdetaillierte Anweisungen umzuwandeln. Antworte in Deutsch." }] }
                // FIX: tools: [{"google_search": {} }] entfernt, um den API-Pfad zu vereinfachen
            };

            try {
                const result = await fetchWithBackoff(API_URL, payload);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Fehler beim Generieren des Prompts. (Keine Textausgabe)";
                outputText.textContent = text.trim();
            } catch (error) {
                // Bei 403-Fehlern die API-Fehlermeldung anzeigen und die API-Funktionen deaktivieren
                if (error.message.includes('403')) {
                    showApiErrorPlaceholder(); // Deaktiviert die Buttons
                    outputText.textContent = `Fehler: Die KI-Funktionalit√§t konnte aufgrund von Berechtigungsproblemen nicht ausgef√ºhrt werden. (403 Forbidden)`;
                } else {
                    outputText.textContent = `Fehler beim Abrufen der KI-Antwort: ${error.message}`;
                }
                console.error("Gemini API Error:", error);
            } finally {
                // UI-Update: Loading beenden und Buttons reaktivieren (falls nicht deaktiviert)
                outputLoading.classList.add('hidden');
                if (!document.getElementById('api-features-container').innerHTML.includes('DEAKTIVIERT')) {
                    document.getElementById('optimize-prompt-btn').disabled = false;
                    document.getElementById('ai-explanation-btn').disabled = false;
                }
            }
        }

        // 3. Gemini Feature: KI-Erkl√§rung
        async function generateAiExplanation() {
            if (!activePromptId) return;

            // F√ºhren Sie die KI-Funktion NICHT aus, wenn ein bekannter Fehler vorliegt
            if (document.getElementById('api-features-container').innerHTML.includes('DEAKTIVIERT')) return;

            const currentPrompts = ALL_CONTENT[activeSeason].prompts;
            const promptData = currentPrompts.find(p => p.id === activePromptId);
            const title = promptData.title;
            const model = promptData.model;

            const outputArea = document.getElementById('output-area');
            const outputTitle = document.getElementById('output-title');
            const outputText = document.getElementById('output-text');
            const outputLoading = document.getElementById('output-loading');

            // UI-Update: Loading starten
            outputArea.classList.remove('hidden');
            outputTitle.textContent = "KI-Erkl√§rung: Warum dieses Tool?";
            outputText.textContent = "";
            outputLoading.classList.remove('hidden');

            // Buttons deaktivieren
            document.getElementById('optimize-prompt-btn').disabled = true;
            document.getElementById('ai-explanation-btn').disabled = true;

            const userQuery = `Erkl√§re in einem knappen Absatz (maximal 6 S√§tze), warum der Anwendungsfall "${title}" am besten durch das Tool oder Modell "${model}" von Google gel√∂st wird. Fokussiere auf die Integration in das Pixel-√ñkosystem und den Nutzen f√ºr den Endanwender. Antworte in deutscher Sprache.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: "Du bist ein Google KI-Experte. Deine Antwort muss kurz, pr√§zise und √ºberzeugend sein. Antworte in Deutsch." }] }
                // FIX: tools: [{"google_search": {} }] entfernt, um den API-Pfad zu vereinfachen
            };

            try {
                const result = await fetchWithBackoff(API_URL, payload);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Fehler beim Generieren der Erkl√§rung. (Keine Textausgabe)";
                outputText.textContent = text.trim();
            } catch (error) {
                // Bei 403-Fehlern die API-Fehlermeldung anzeigen und die API-Funktionen deaktivieren
                if (error.message.includes('403')) {
                    showApiErrorPlaceholder(); // Deaktiviert die Buttons
                    outputText.textContent = `Fehler: Die KI-Funktionalit√§t konnte aufgrund von Berechtigungsproblemen nicht ausgef√ºhrt werden. (403 Forbidden)`;
                } else {
                    outputText.textContent = `Fehler beim Abrufen der KI-Antwort: ${error.message}`;
                }
                console.error("Gemini API Error:", error);
            } finally {
                // UI-Update: Loading beenden und Buttons reaktivieren (falls nicht deaktiviert)
                outputLoading.classList.add('hidden');
                if (!document.getElementById('api-features-container').innerHTML.includes('DEAKTIVIERT')) {
                    document.getElementById('optimize-prompt-btn').disabled = false;
                    document.getElementById('ai-explanation-btn').disabled = false;
                }
            }
        }


        // 4. Saison wechseln und Inhalte neu laden
        function changeSeason(season) {
            activeSeason = season;
            activePromptId = null; // Detailansicht zur√ºcksetzen
            loadPromptCards();
            document.getElementById('detail-placeholder').classList.remove('hidden');
            document.getElementById('detail-content').classList.add('hidden');
            document.getElementById('detail-title').classList.add('hidden');
            document.getElementById('output-area').classList.add('hidden'); // Output-Bereich verstecken

            // Titel der Sektion anpassen
            document.getElementById('prompt-section-title').textContent = ALL_CONTENT[season].title;
            
            // Generische FAQ anzeigen, bis ein Prompt ausgew√§hlt wird
            loadFaqs([]);
        }

        // 5. Initialisierung und Laden der Prompt-Karten
        function loadPromptCards() {
            const cardsContainer = document.getElementById('prompt-cards-container');
            cardsContainer.innerHTML = ''; // Vorherige Karten entfernen
            const prompts = ALL_CONTENT[activeSeason].prompts;

            prompts.forEach(prompt => {
                const card = document.createElement('div');
                card.id = `card-${prompt.id}`;
                // Setze die Klassen f√ºr das Design
                card.className = 'prompt-card bg-white/5 p-6 rounded-xl shadow-lg border border-gemini-teal/30 hover:bg-white/10';
                card.setAttribute('data-id', prompt.id);
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-gemini-teal">${prompt.title}</h3>
                    <p class="text-sm text-gray-400 mt-2">Empfohlen: <span class="font-semibold text-gemini-gold">${prompt.model}</span></p>
                `;
                
                card.addEventListener('click', () => showPromptDetails(prompt.id));
                cardsContainer.appendChild(card);
            });
             // FAQs laden (initially general ones)
             loadFaqs([]);
        }

        // 6. Anzeige der Prompt-Details und Laden der Kontext-FAQs
        function showPromptDetails(id) {
            const currentPrompts = ALL_CONTENT[activeSeason].prompts;
            const promptData = currentPrompts.find(p => p.id === id);
            
            if (!promptData) return;

            activePromptId = id;

            // Detailansicht aktualisieren
            document.getElementById('detail-placeholder').classList.add('hidden');
            document.getElementById('detail-content').classList.remove('hidden');
            document.getElementById('detail-title').classList.remove('hidden');
            document.getElementById('output-area').classList.add('hidden'); // Output-Bereich verstecken bei neuem Prompt

            document.getElementById('detail-title').textContent = promptData.title;
            document.getElementById('detail-prompt').textContent = promptData.prompt;
            document.getElementById('detail-model').textContent = promptData.model;
            document.getElementById('detail-explanation').innerHTML = promptData.explanation;

            // Visuelles Feedback: Aktive Karte hervorheben
            document.querySelectorAll('.prompt-card').forEach(card => {
                card.classList.remove('border-gemini-gold', 'ring-2', 'ring-gemini-gold');
            });
            document.getElementById(`card-${id}`).classList.add('border-gemini-gold', 'ring-2', 'ring-gemini-gold');
            
            // Kontext-FAQs laden
            loadFaqs(promptData.faqs);
        }

        // 7. FAQ Sektion dynamisch f√ºllen
        function loadFaqs(contextFaqIds) {
            const faqContainer = document.getElementById('faq-container');
            faqContainer.innerHTML = ''; // Bestehende FAQs entfernen

            // 1. Allgemeine Basis-FAQs hinzuf√ºgen (immer sichtbar, wenn kein Prompt ausgew√§hlt)
            const generalFaqIds = ["faq-updates", "faq-akku", "faq-live-cam"];
            const allFaqIds = activePromptId ? contextFaqIds : generalFaqIds;
            
            // Filtere Duplikate und gehe die IDs durch
            const uniqueFaqIds = Array.from(new Set(allFaqIds));

            uniqueFaqIds.forEach(id => {
                const faq = ALL_FAQS[id];
                if (faq) {
                    const item = document.createElement('div');
                    item.className = 'border-b border-gray-700 pb-2 accordion-item';
                    item.innerHTML = `
                        <button class="flex justify-between items-center w-full py-2 text-left font-semibold hover:text-gemini-gold transition duration-150" onclick="toggleAccordion('${id}')">
                            ${faq.title}
                            <span class="text-gemini-gold text-lg font-normal">+</span>
                        </button>
                        <div id="${id}" class="accordion-content">
                            <p class="py-2 text-gray-300">${faq.content}</p>
                        </div>
                    `;
                    faqContainer.appendChild(item);
                }
            });

             // Wenn kein Prompt aktiv ist, zeige eine Aufforderung an
            if (uniqueFaqIds.length === 0 && !activePromptId) {
                 faqContainer.innerHTML = '<p class="text-center italic text-gray-400 py-4">W√§hle eine Prompt-Idee, um vertiefende Fragen und Antworten zu sehen.</p>';
            }
        }

        // 8. Akkordeon-Funktion
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            if (!content) return;

            const button = content.previousElementSibling;
            const span = button.querySelector('span');

            if (content.classList.contains('active')) {
                content.classList.remove('active');
                span.textContent = '+';
            } else {
                // Schlie√üe alle anderen offenen Akkordeons im FAQ-Container
                document.querySelectorAll('#faq-container .accordion-content.active').forEach(item => {
                    item.classList.remove('active');
                    item.previousElementSibling.querySelector('span').textContent = '+';
                });

                content.classList.add('active');
                span.textContent = '‚Äì';
            }
        }

        // Starte die Anwendung, w√§hle Weihnachten als Standard
        window.onload = function() {
            // Setze das Dropdown auf den Startwert
            document.getElementById('season-select').value = "Weihnachten";
            // Lade die Inhalte
            changeSeason("Weihnachten");
        };

    </script>
</body>
</html>
